{#
| Variable                     | Type    | Description                                                       |
|------------------------------|---------|-------------------------------------------------------------------|
| video_url                    | string  | MP4 video source for the background                               |
| poster_image                 | string  | Optional fallback image shown while the video loads               |
| badge_text                   | string  | Text displayed inside the badge above the title                   |
| title                        | string  | Main heading text                                                  |
| subtitle                     | string  | Secondary heading text                                             |
| description                  | string  | Paragraph beneath the heading                                      |
| primary_cta_text             | string  | Label for the primary button                                       |
| primary_cta_url              | string  | Link for the primary button                                        |
| secondary_cta_text           | string  | Label for the secondary button                                     |
| secondary_cta_url            | string  | Link for the secondary button                                      |
| stats[]                      | array   | Optional collection of stat objects                                |
| stats[].value                | string  | Highlighted number for a stat                                      |
| stats[].label                | string  | Supporting caption for a stat                                      |
| start_muted                  | bool    | Whether the banner video should start muted (default: true)        |
| mute_label                   | string  | Accessible label for the "mute" state                              |
| unmute_label                 | string  | Accessible label for the "unmute" state                            |
| position                     | int     | Component position on the page (used to generate unique IDs)       |
#}

{% set start_muted = component.start_muted is defined ? component.start_muted : true %}
{% set video_url = component.video_url|default('/videos/banner-video.mp4') %}
{% set poster_image = component.poster_image|default('/src/assets/hero-car.jpg') %}
{% set badge_text = component.badge_text|default('عرض خاص') %}
{% set title = component.title|default('اكتشف تجربة القيادة القصوى') %}
{% set subtitle = component.subtitle|default('أداء لا يُقارن') %}
{% set description = component.description|default('تقنيات متطورة وتصميم رياضي يمنحانك قوة إضافية على الطريق.') %}
{% set primary_cta_text = component.primary_cta_text|default('شاهد الفيديو') %}
{% set primary_cta_url = component.primary_cta_url|default('#') %}
{% set secondary_cta_text = component.secondary_cta_text|default('تعرّف على المزيد') %}
{% set secondary_cta_url = component.secondary_cta_url|default('#') %}
{% set primary_cta_target = component.primary_cta_target|default('_self') %}
{% set secondary_cta_target = component.secondary_cta_target|default('_self') %}
{% set mute_label = component.mute_label|default('كتم الصوت') %}
{% set unmute_label = component.unmute_label|default('تشغيل الصوت') %}
{% set stats = component.stats is iterable and component.stats|length > 0
  ? component.stats
  : [
      { 'value': '500+', 'label': 'طراز متاح' },
      { 'value': '50K+', 'label': 'عملاء راضون' },
      { 'value': '99%', 'label': 'رضا العملاء' }
    ]
%}

{% set video_id = 'video-banner-video-' ~ (position|default(0)) %}
{% set toggle_id = 'video-banner-toggle-' ~ (position|default(0)) %}

<section class="relative w-full h-[600px] md:h-[700px] overflow-hidden video-banner-component">
  <video
    id="{{ video_id }}"
    class="absolute inset-0 w-full h-full object-cover"
    {% if start_muted %}muted{% endif %}
    autoplay
    loop
    playsinline
    preload="auto"
    {% if poster_image %}poster="{{ poster_image }}"{% endif %}
  >
    {% if video_url %}
      <source src="{{ video_url }}" type="video/mp4">
    {% endif %}
    {% if poster_image %}
      <img src="{{ poster_image }}" alt="{{ title }}" class="w-full h-full object-cover">
    {% endif %}
  </video>

  <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/50 to-black/70"></div>

  <div class="absolute inset-0 pointer-events-none z-10">
    <div class="absolute top-0 left-0 w-32 h-32 border-t-4 border-l-4 border-primary animate-pulse-glow"></div>
    <div class="absolute top-0 right-0 w-32 h-32 border-t-4 border-r-4 border-accent animate-pulse-glow" style="animation-delay: 0.5s;"></div>
    <div class="absolute bottom-0 left-0 w-32 h-32 border-b-4 border-l-4 border-accent animate-pulse-glow" style="animation-delay: 1s;"></div>
    <div class="absolute bottom-0 right-0 w-32 h-32 border-b-4 border-r-4 border-primary animate-pulse-glow" style="animation-delay: 1.5s;"></div>
  </div>

  <div class="absolute inset-0 pointer-events-none opacity-30">
    <div class="absolute top-1/4 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-primary to-transparent animate-speed-line"></div>
    <div class="absolute top-1/2 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-accent to-transparent animate-speed-line" style="animation-delay: 0.5s;"></div>
    <div class="absolute top-3/4 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-primary to-transparent animate-speed-line" style="animation-delay: 1s;"></div>
  </div>

  <div class="relative z-20 h-full flex flex-col items-center justify-center px-4 text-center">
    {% if badge_text %}
      <div class="mb-6 animate-fade-in-up">
        <div class="inline-flex items-center gap-2 px-6 py-2 bg-primary/20 backdrop-blur-md border border-primary/50 rounded-full">
          <span class="w-2 h-2 bg-primary rounded-full animate-pulse" aria-hidden="true"></span>
          <span class="text-primary font-semibold tracking-wider text-sm uppercase">
            {{ badge_text }}
          </span>
        </div>
      </div>
    {% endif %}

    <h1
      class="font-racing text-5xl md:text-7xl lg:text-8xl mb-6 animate-fade-in-up text-white drop-shadow-2xl"
      style="animation-delay: 0.2s;"
    >
      <span class="text-gradient block mb-2">
        {{ title }}
      </span>
      <span class="text-white">
        {{ subtitle }}
      </span>
    </h1>

    {% if description %}
      <p
        class="text-white/90 text-lg md:text-xl max-w-3xl mb-10 leading-relaxed animate-fade-in-up drop-shadow-lg"
        style="animation-delay: 0.4s;"
      >
        {{ description }}
      </p>
    {% endif %}

    <div
      class="flex flex-col sm:flex-row gap-4 animate-fade-in-up"
      style="animation-delay: 0.6s;"
    >
      {% if primary_cta_text %}
        <a
          href="{{ primary_cta_url }}"
          target="{{ primary_cta_target }}"
          class="group relative px-8 py-4 bg-gradient-to-r from-primary to-accent text-white font-racing text-lg rounded-lg overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/50"
        >
          <span class="relative z-10 flex items-center gap-2 justify-center">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M8 5v14l11-7z"></path>
            </svg>
            {{ primary_cta_text }}
          </span>
          <span class="absolute inset-0 bg-gradient-to-r from-accent to-primary opacity-0 group-hover:opacity-100 transition-opacity duration-300" aria-hidden="true"></span>
        </a>
      {% endif %}

      {% if secondary_cta_text %}
        <a
          href="{{ secondary_cta_url }}"
          target="{{ secondary_cta_target }}"
          class="px-8 py-4 bg-white/10 backdrop-blur-md border-2 border-white/30 text-white font-racing text-lg rounded-lg hover:bg-white/20 hover:border-white/50 transition-all duration-300 hover:scale-105"
        >
          {{ secondary_cta_text }}
        </a>
      {% endif %}
    </div>

    {% if stats and stats|length > 0 %}
      <div
        class="mt-16 grid gap-8 md:gap-16 animate-fade-in-up"
        style="animation-delay: 0.8s; grid-template-columns: repeat({{ [stats|length, 3]|min }}, minmax(0, 1fr));"
      >
        {% for stat in stats %}
          <div class="text-center">
            {% if stat.value %}
              <div class="font-racing text-4xl md:text-5xl text-gradient mb-2">
                {{ stat.value }}
              </div>
            {% endif %}
            {% if stat.label %}
              <div class="text-white/80 text-sm uppercase tracking-wide">
                {{ stat.label }}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <button
    id="{{ toggle_id }}"
    type="button"
    class="absolute bottom-8 right-8 z-30 p-3 bg-black/50 backdrop-blur-md border border-white/20 rounded-full text-white hover:bg-black/70 hover:border-primary transition-all duration-300 hover:scale-110 group"
    aria-label="{{ start_muted ? unmute_label : mute_label }}"
  >
    <span data-icon="mute" class="{{ start_muted ? '' : 'hidden' }}">
      <svg class="w-6 h-6 group-hover:text-primary transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M11 5 6.5 8.5H4v7h2.5L11 19z"></path>
        <line x1="22" y1="9" x2="18" y2="13"></line>
        <line x1="18" y1="9" x2="22" y2="13"></line>
      </svg>
    </span>
    <span data-icon="unmute" class="{{ start_muted ? 'hidden' : '' }}">
      <svg class="w-6 h-6 group-hover:text-primary transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M11 5 6.5 8.5H4v7h2.5L11 19z"></path>
        <path d="M19 5a8 8 0 0 1 0 14"></path>
        <path d="M16 9.5a4 4 0 0 1 0 5"></path>
      </svg>
    </span>
  </button>

  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20 animate-bounce">
    <div class="w-6 h-10 border-2 border-white/50 rounded-full p-1">
      <div class="w-1 h-2 bg-white rounded-full mx-auto animate-pulse"></div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var video = document.getElementById('{{ video_id }}');
    var toggleButton = document.getElementById('{{ toggle_id }}');
    if (!video || !toggleButton) {
      return;
    }

    var muteIcon = toggleButton.querySelector('[data-icon="mute"]');
    var unmuteIcon = toggleButton.querySelector('[data-icon="unmute"]');

    function updateIcons() {
      if (muteIcon && unmuteIcon) {
        muteIcon.classList.toggle('hidden', !video.muted);
        unmuteIcon.classList.toggle('hidden', video.muted);
      }
      toggleButton.setAttribute('aria-label', video.muted ? '{{ unmute_label|e('js') }}' : '{{ mute_label|e('js') }}');
    }

    updateIcons();

    toggleButton.addEventListener('click', function (event) {
      event.preventDefault();
      video.muted = !video.muted;
      updateIcons();
    });
  });
</script>
