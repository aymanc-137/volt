{% set testimonials = component.items is iterable ? component.items : [] %}

<section class="s-block s-block--custom-testimonials py-14" dir="rtl">
  <div class="max-w-6xl mx-auto px-4">
    <div class="text-center mb-10">
      <h1 class="text-3xl font-alshohadaa font-bold dynamic-text-color">{{ trans('blocks.home.testimonials') }}</h1>
    </div>

    {% if testimonials %}
      <salla-slider
        id="custom-testimonials-{{ position }}-slider"
        type="testimonials"
        centered
        slides-per-view="1"
        controls-outer
        auto-play
        class="testimonials-slider"
      >
        <div slot="items">
          {% for index, item in testimonials %}
            {% set avatar_src = item.avatar|default('') %}
            {% if not avatar_src %}
              {% set avatar_src = 'images/s-empty.png' | asset %}
            {% endif %}
            {% set total_stars = item.stars|default(5) %}
            {% set total_stars = total_stars > 5 ? 5 : total_stars %}
            {% set total_stars = total_stars < 0 ? 0 : total_stars %}

            <div class="swiper-slide !w-auto px-4 py-4">
              <article class="relative  w-80 sm:w-96 max-w-full mx-auto
              
              bg-[var(--color-light-box-background)]

              dark:bg-[var(--color-dark-box-background)]

               dynamic-border-color border rounded-custom  
               text-right
               dynamic-text-color shadow-xl">
                <svg class="w-8 h-8 text-primary mb-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z" />
                </svg>

                <p class=" dynamic-text-color leading-relaxed p-5 mb-8">{{ item.text }}</p>

                <div class="relative border-t border-primary  
                bg-[var(--color-primary-5)]   pt-8 p-5">
                  <div class="absolute left-1/2 -translate-x-1/2 -translate-y-1/2">
                    <div class="w-16 h-16 r   ">
                      <div class="w-full h-full rounded-full overflow-hidden -mt-10 border-4  ">
                        <img
                          src="{{ avatar_src }}"
                          alt="{{ item.name|trim ? item.name : 'testimonial-' ~ index }}"
                          class="w-full h-full object-cover"
                          loading="lazy"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <div class="text-center   bg-[var(--color-primary-5)]  p-5 ">
                  <h3 class="dynamic-text-color text-xl font-semibold mb-3">{{ item.name|default('عميل متجرنا') }}</h3>
                  <div class="flex justify-center gap-1" aria-label="{{ total_stars }} / 5">
                    {% for star in 1..5 %}
                      {% set is_filled = star <= total_stars %}
                      <svg
                        class="w-6 h-6 {{ is_filled ? 'text-[var(--color-primary)]' : 'text-gray-600' }}"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                        aria-hidden="true"
                      >
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                      </svg>
                    {% endfor %}
                  </div>
                </div>
              </article>
            </div>
          {% endfor %}
        </div>
      </salla-slider>
    {% else %}
      <div class="text-center text-neutral-500 border border-dashed border-neutral-400 rounded-custom p-10">
        أضف تقييمات من إعدادات المكون ليظهر المحتوى هنا.
      </div>
    {% endif %}
  </div>
</section>
